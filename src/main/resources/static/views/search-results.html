<div>
    <h2>üîç Used Caravan Search Results</h2>

    <!-- Header with actions -->
    <div class="mb-3">
        <button class="btn btn-secondary" ng-click="backToCaravans()">‚Üê Back to Caravans</button>
        <button class="btn btn-success" ng-click="showCreateSearchForm()" ng-if="!isCreatingSearch">+ New Search</button>
        <span class="float-end" ng-if="make && model">
            Showing results for: <strong>{{make}} {{model}}</strong>
        </span>
    </div>

    <!-- Create New Search Form -->
    <div class="card mb-3" ng-if="isCreatingSearch">
        <div class="card-header">
            <h5>Create New Search Result</h5>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Make *</label>
                    <input type="text" class="form-control" ng-model="newSearchResult.make" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Model *</label>
                    <input type="text" class="form-control" ng-model="newSearchResult.model" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Search Query</label>
                    <input type="text" class="form-control" ng-model="newSearchResult.searchQuery">
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea class="form-control" ng-model="newSearchResult.notes" rows="2"></textarea>
            </div>

            <h6>Search Results Details</h6>
            <button class="btn btn-sm btn-secondary mb-2" ng-click="addDetailRow()">+ Add Result</button>

            <div ng-if="newSearchResult.details.length === 0" class="alert alert-info">
                No results added yet. Click "+ Add Result" to add search findings.
            </div>

            <div ng-repeat="detail in newSearchResult.details" class="card mb-2">
                <div class="card-body">
                    <button class="btn btn-sm btn-danger float-end" ng-click="removeDetailRow($index)">Remove</button>
                    <h6>Result {{$index + 1}}</h6>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" ng-model="detail.title">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Price (AUD)</label>
                            <input type="number" class="form-control" ng-model="detail.price">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Year</label>
                            <input type="number" class="form-control" ng-model="detail.year">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" ng-model="detail.location">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Seller</label>
                            <input type="text" class="form-control" ng-model="detail.seller">
                        </div>
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Condition</label>
                            <input type="text" class="form-control" ng-model="detail.condition" placeholder="e.g., Excellent">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-2">
                            <label class="form-label">Listing URL</label>
                            <input type="text" class="form-control" ng-model="detail.listingUrl">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-2">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" ng-model="detail.description" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-2">
                            <label class="form-label">Specifications</label>
                            <textarea class="form-control" ng-model="detail.specifications" rows="2"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                <button class="btn btn-primary" ng-click="saveSearchResult()">Save Search Result</button>
                <button class="btn btn-secondary" ng-click="cancelCreateSearch()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Search Results List -->
    <div class="row" ng-if="!isCreatingSearch">
        <!-- Left Panel: Search List -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Searches ({{searchResults.length}})</h5>
                </div>
                <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                    <div ng-if="searchResults.length === 0" class="text-center text-muted">
                        No search results found
                    </div>
                    <div ng-repeat="searchResult in searchResults"
                         class="card mb-2"
                         ng-class="{'border-primary': selectedSearchResult && selectedSearchResult.id === searchResult.id}"
                         style="cursor: pointer;">
                        <div class="card-body" ng-click="selectSearchResult(searchResult)">
                            <h6 class="card-title">{{searchResult.make}} {{searchResult.model}}</h6>
                            <p class="card-text text-muted mb-1">
                                <small>{{searchResult.searchDate | date:'dd/MM/yyyy HH:mm'}}</small>
                            </p>
                            <p class="card-text">
                                <span class="badge bg-info">{{searchResult.totalResults}} results</span>
                            </p>
                            <button class="btn btn-sm btn-danger" ng-click="deleteSearchResult(searchResult); $event.stopPropagation()">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Search Details -->
        <div class="col-md-8">
            <div class="card" ng-if="!selectedSearchResult">
                <div class="card-body text-center text-muted">
                    <p>Select a search from the list to view details</p>
                </div>
            </div>

            <div class="card" ng-if="selectedSearchResult">
                <div class="card-header">
                    <h5>{{selectedSearchResult.make}} {{selectedSearchResult.model}}</h5>
                    <p class="mb-0">
                        <small class="text-muted">
                            Searched: {{selectedSearchResult.searchDate | date:'dd/MM/yyyy HH:mm'}} |
                            Results: {{selectedSearchResult.totalResults}}
                        </small>
                    </p>
                    <p class="mb-0" ng-if="selectedSearchResult.searchQuery">
                        <small><strong>Query:</strong> {{selectedSearchResult.searchQuery}}</small>
                    </p>
                    <p class="mb-0" ng-if="selectedSearchResult.notes">
                        <small><strong>Notes:</strong> {{selectedSearchResult.notes}}</small>
                    </p>
                </div>
                <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                    <div ng-if="searchResultDetails.length === 0" class="text-center text-muted">
                        No detailed results for this search
                    </div>

                    <div ng-repeat="detail in searchResultDetails" class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">{{detail.title}}</h6>

                            <div class="row mb-2">
                                <div class="col-md-4" ng-if="detail.price">
                                    <strong>Price:</strong> ${{detail.price | number:0}}
                                </div>
                                <div class="col-md-4" ng-if="detail.year">
                                    <strong>Year:</strong> {{detail.year}}
                                </div>
                                <div class="col-md-4" ng-if="detail.condition">
                                    <strong>Condition:</strong> {{detail.condition}}
                                </div>
                            </div>

                            <div class="row mb-2">
                                <div class="col-md-6" ng-if="detail.location">
                                    <strong>Location:</strong> {{detail.location}}
                                </div>
                                <div class="col-md-6" ng-if="detail.seller">
                                    <strong>Seller:</strong> {{detail.seller}}
                                </div>
                            </div>

                            <p ng-if="detail.description" class="mb-2">
                                <strong>Description:</strong><br>
                                {{detail.description}}
                            </p>

                            <p ng-if="detail.specifications" class="mb-2">
                                <strong>Specifications:</strong><br>
                                {{detail.specifications}}
                            </p>

                            <p ng-if="detail.notes" class="mb-2">
                                <strong>Notes:</strong><br>
                                {{detail.notes}}
                            </p>

                            <a ng-if="detail.listingUrl" href="{{detail.listingUrl}}" target="_blank" class="btn btn-sm btn-primary">
                                View Listing
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
